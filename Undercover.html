<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Undercover - Gioco di parole</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #fff;
      margin: 0;
      padding: 0;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }
    h1 {
      font-size: 1.8rem;
      margin-bottom: 1rem;
    }
    form, .game-area {
      width: 100%;
      max-width: 500px;
    }
    input, button, select, textarea {
      width: 100%;
      padding: 0.7rem;
      margin: 0.5rem 0;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-sizing: border-box;
    }
    button {
      background-color: #007aff;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    .player-list {
      list-style: none;
      padding: 0;
    }
    .player-list li {
      padding: 0.5rem;
      border-bottom: 1px solid #eee;
    }
    #toggleRolesBtn {
      margin-bottom: 1rem;
      background-color: #555;
    }
  </style>
</head>
<body>
  <h1>Gioco Undercover</h1>
  <form id="setupForm">
    <label for="players">Inserisci i nomi dei giocatori (uno per riga, nell'ordine):</label>
    <textarea id="players" rows="6" placeholder="Es. Luca\nGiulia\nMarco..."></textarea>

    <label for="numUndercover">Numero di Undercover:</label>
    <input type="number" id="numUndercover" min="0" max="5" value="1">

    <label for="includeWhite">Includi Mister White?</label>
    <select id="includeWhite">
      <option value="yes">Sì</option>
      <option value="no">No</option>
    </select>

    <button type="submit">Inizia Partita</button>
  </form>

  <div class="game-area" id="gameArea" style="display:none;">
    <h2>Ruoli assegnati</h2>
    <button id="toggleRolesBtn" type="button">Nascondi Ruoli</button>
    <ul class="player-list" id="playerRoles"></ul>
    <button id="voteBtn" type="button" style="display:none; margin-top:1rem;">Al voto</button>
    <div id="voteArea" style="display:none; max-width:500px; margin-top:1rem;"></div>
    <div id="resultArea" style="display:none; max-width:500px; margin-top:1rem; font-weight:bold;"></div>
  </div>

  <script>
    const wordPairs = [
      ["console", "PC"], ["skincare", "makeup"],  ["streamer", "youtuber"], ["Nintendo", "PlayStation"],
["manga", "anime"], ["caffè", "tè"], ["pizza", "hamburger"], ["gatto", "cane"],
      ["libro", "film"], ["calcio", "basket"], ["rock", "metal"], ["sci-fi", "fantasy"],
      ["viaggio", "vacanza"], ["città", "campagna"], ["mare", "montagna"], ["teatro", "cinema"],
      ["arte", "musica"], ["fotografia", "pittura"], ["storia", "geografia"], ["scienza", "tecnologia"], ["elettrico", "ibrido"],
["smartworking", "remoto"], ["sanremo", "eurovision"], ["AI", "ChatGPT"], ["slip", "boxer"],
["tanga", "perizoma"], ["bacio", "lingua"], ["scorreggia", "vento"], ["banana", "cetriolo"]
    ];

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    let players = [];
let roles = [];
let civilWord = "";
let undercoverWord = "";
let eliminated = []; // Array per tenere traccia degli eliminati

function renderPlayerList() {
  const list = document.getElementById("playerRoles");
  list.innerHTML = "";
  players.forEach((name, index) => {
    if (eliminated.includes(index)) return; // Salta eliminati
    let word = roles[index] === "Undercover" ? undercoverWord : (roles[index] === "Mister White" ? "???" : civilWord);
    const li = document.createElement("li");
    li.style.display = "flex";
    li.style.alignItems = "center";
    li.style.justifyContent = "space-between";

    const nameSpan = document.createElement("span");
    nameSpan.textContent = name;

    const roleSpan = document.createElement("span");
    if (roles[index] === "Mister White") {
      roleSpan.textContent = "???";
    } else {
      roleSpan.textContent = word;
    }
    roleSpan.style.display = "none";
    roleSpan.style.marginLeft = "1rem";

    const btn = document.createElement("button");
    btn.textContent = "Mostra ruolo";
    btn.style.width = "auto";
    btn.style.marginLeft = "1rem";
    btn.addEventListener("click", function() {
      if (roleSpan.style.display === "none") {
        roleSpan.style.display = "inline";
        btn.textContent = "Nascondi ruolo";
      } else {
        roleSpan.style.display = "none";
        btn.textContent = "Mostra ruolo";
      }
    });

    li.appendChild(nameSpan);
    li.appendChild(btn);
    li.appendChild(roleSpan);
    list.appendChild(li);
  });
}

    document.getElementById("setupForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const playerLines = document.getElementById("players").value.trim().split("\n");
      const numUndercover = parseInt(document.getElementById("numUndercover").value);
      const includeWhite = document.getElementById("includeWhite").value === "yes";

      if (playerLines.length < numUndercover + (includeWhite ? 1 : 0) + 2) {
        alert("Troppi ruoli rispetto al numero di giocatori!");
        return;
      }

      players = playerLines.map(name => name.trim()).filter(name => name);
      shuffle(players);

      [civilWord, undercoverWord] = wordPairs[Math.floor(Math.random() * wordPairs.length)];

      roles = Array(players.length).fill("Civile");
      for (let i = 0; i < numUndercover; i++) roles[i] = "Undercover";
      if (includeWhite) roles[numUndercover] = "Mister White";
      shuffle(roles);

      eliminated = [];
      renderPlayerList();

      document.getElementById("gameArea").style.display = "block";
      document.getElementById("playerRoles").style.display = "block";
      document.getElementById("toggleRolesBtn").textContent = "Nascondi Ruoli";
      document.getElementById("voteBtn").style.display = "inline-block";
      document.getElementById("voteArea").style.display = "none";
      document.getElementById("resultArea").style.display = "none";
    });

    document.getElementById("toggleRolesBtn").addEventListener("click", function() {
      const list = document.getElementById("playerRoles");
      if (list.style.display === "none") {
        list.style.display = "block";
        this.textContent = "Nascondi Ruoli";
      } else {
        list.style.display = "none";
        this.textContent = "Mostra Ruoli";
      }
    });

    // Sistema di voto aggiornato
    document.getElementById("voteBtn").addEventListener("click", function() {
      const voteArea = document.getElementById("voteArea");
      voteArea.innerHTML = "<h3>Vota chi eliminare:</h3>";
      voteArea.style.display = "block";
      document.getElementById("resultArea").style.display = "none";
      players.forEach((name, idx) => {
        if (eliminated.includes(idx)) return; // Salta eliminati
        const btn = document.createElement("button");
        btn.textContent = name;
        btn.style.margin = "0.3rem";
        btn.addEventListener("click", function() {
          voteArea.style.display = "none";
          eliminated.push(idx); // Segna come eliminato
          renderPlayerList(); // Aggiorna lista

          // Controllo vittoria Mister White
          const inGioco = players
            .map((_, i) => i)
            .filter(i => !eliminated.includes(i));
          const restanti = inGioco.map(i => roles[i]);
          if (restanti.length === 1 && restanti[0] === "Mister White") {
            document.getElementById("resultArea").textContent = "Ha vinto Mr White!";
            document.getElementById("resultArea").style.display = "block";
            return;
          }

          const role = roles[idx];
          if (role === "Civile") {
            document.getElementById("resultArea").textContent = "Un civile è stato eliminato.";
            document.getElementById("resultArea").style.display = "block";
          } else if (role === "Undercover") {
            document.getElementById("resultArea").textContent = "Un undercover è stato eliminato.";
            document.getElementById("resultArea").style.display = "block";
          } else if (role === "Mister White") {
            // Mister White deve indovinare la parola
            document.getElementById("resultArea").innerHTML = `
              Mister White è stato eliminato!<br>
              Prova a indovinare la parola comune dei civili:<br>
              <input type="text" id="whiteGuess" style="margin-top:0.5rem; text-transform:lowercase;">
              <button id="submitGuess" style="margin-left:0.5rem;">Conferma</button>
            `;
            document.getElementById("resultArea").style.display = "block";
            document.getElementById("submitGuess").onclick = function() {
              const guess = document.getElementById("whiteGuess").value.trim().toLowerCase();
              if (guess === civilWord.toLowerCase()) {
                document.getElementById("resultArea").textContent = "Ha vinto Mr White!";
              } else {
                document.getElementById("resultArea").textContent = "Mister White ha fallito! Il gioco ricomincia.";
                setTimeout(() => {
                  location.reload();
                }, 2000);
              }
            };
          }
        });
        voteArea.appendChild(btn);
      });
    });
  </script>
</body>
</html>